<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personnalisation JOSY</title>
  <style>
    :root {
      --Color_1: #202020;
      --Color_2: #EAEAEA;
      --Color_3: #9400D3;
    }

    body {
      background-color: var(--Color_1);
      color: var(--Color_2);
      font-family: "Poppins", sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      display: flex;
      gap: 60px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      max-width: 1100px;
      padding: 40px;
    }

    .preview {
      position: relative;
      width: 450px;
      height: 350px;
      background-color: #2a2a2a;
      border-radius: 20px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transition: opacity 0.4s ease;
    }

    .preview button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background-color: rgba(234, 234, 234, 0.1);
      color: var(--Color_2);
      border: none;
      cursor: pointer;
      padding: 10px 15px;
      border-radius: 50%;
      transition: background-color 0.3s;
      font-size: 1.4em;
    }

    .preview button:hover {
      background-color: var(--Color_3);
    }

    .preview .left { left: 10px; }
    .preview .right { right: 10px; }

    .options {
      display: flex;
      flex-direction: column;
      gap: 25px;
      min-width: 280px;
    }

    .option {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    label {
      font-weight: 500;
      font-size: 1.1em;
    }

    select {
      background-color: var(--Color_2);
      color: var(--Color_1);
      border: none;
      padding: 10px;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      transition: 0.3s;
    }

    select:hover { transform: scale(1.02); }

    .color-options {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .color-dot {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid var(--Color_2);
      transition: 0.3s;
    }

    .color-dot:hover {
      transform: scale(1.2);
      border-color: var(--Color_3);
    }

    .color-dot.active {
      border-color: var(--Color_3);
      transform: scale(1.15);
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="preview">
      <button class="left">‹</button>
      <img id="productImage" src="Image/Casquette_Josy_mot/Logo_JOSYnedit/classic-dad-hat-black-right-side.png" alt="Casquette JOSY">
      <button class="right">›</button>
    </div>

    <div class="options">
      <!-- Couleur produit -->
      <div class="option">
        <label>Couleur du produit</label>
        <div class="color-options" id="productColors">
          <div class="color-dot active" data-color="black" style="background:#202020"></div>
          <div class="color-dot" data-color="dark-grey" style="background:#4a4a4a"></div>
          <div class="color-dot" data-color="navy" style="background:#000948"></div>
          <div class="color-dot" data-color="stone" style="background:#b8a896"></div>
          <div class="color-dot" data-color="pink" style="background:#FF69B4"></div>
          <div class="color-dot" data-color="white" style="background:#ffffff"></div>
          <div class="color-dot" data-color="light-blue" style="background:#59bffa"></div>
          <div class="color-dot" data-color="cranberry" style="background:#b33232"></div>
          <div class="color-dot" data-color="spruce" style="background:#115b27"></div>          
        </div>
      </div>

      <!-- Style -->
      <div class="option">
        <label>Style</label>
        <select id="styleSelect">
          <option value="logo">Logo JOSY</option>
          <option value="signature">Signature JOSY</option>
        </select>
      </div>

      <!-- Mot -->
      <div class="option" id="motOption">
        <label>Mot JOSY</label>
        <select id="motSelect">
          <option value="JOSYnedit">JOSYnedit</option>
          <option value="JOSYdee">JOSYdee</option>
          <option value="JOSYdiot">JOSYdiot</option>
          <option value="JOSYdeal">JOSYdéal</option>
          <option value="JOSYgloo">JOSYgloo</option>
        </select>
      </div>

      <!-- Couleurs Signature (cachées au départ) -->
      <div class="option hidden" id="signatureColors">
        <label>Couleur de la Signature</label>
        <div class="color-options">
          <div class="color-dot active" data-signature="black" style="background:#202020"></div>
          <div class="color-dot" data-signature="blue" style="background:#255ed0"></div>
          <div class="color-dot" data-signature="pink" style="background:#FF69B4"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
  const typeSelect = document.getElementById("styleSelect");
  const motSelect = document.getElementById("motSelect");
  const motOption = document.getElementById("motOption");
  const productImage = document.getElementById("productImage");
  const leftBtn = document.querySelector(".left");
  const rightBtn = document.querySelector(".right");
  const colorDots = document.querySelectorAll("#productColors .color-dot");
  const signatureColors = document.getElementById("signatureColors");
  const signatureDots = signatureColors.querySelectorAll(".color-dot");

    const baseImages = {
      black: [
        "classic-dad-hat-black-back.png",
        "classic-dad-hat-black-right-side.png",
        "classic-dad-hat-black-right-front.png",
        "classic-dad-hat-black-front.png",
        "classic-dad-hat-black-left-front.png",
        "classic-dad-hat-black-left-side.png",
        "classic-dad-hat-black-product-details.png"
      ],
      "dark-grey": [
        "classic-dad-hat-dark-grey-back.png",
        "classic-dad-hat-dark-grey-right-side.png",
        "classic-dad-hat-dark-grey-right-front.png",
        "classic-dad-hat-dark-grey-front.png",
        "classic-dad-hat-dark-grey-left-front.png",
        "classic-dad-hat-dark-grey-left-side.png",
        "classic-dad-hat-dark-grey-product-details.png"
      ],
      stone: [
        "classic-dad-hat-stone-back.png",
        "classic-dad-hat-stone-right-side.png",
        "classic-dad-hat-stone-right-front.png",
        "classic-dad-hat-stone-front.png",
        "classic-dad-hat-stone-left-front.png",
        "classic-dad-hat-stone-left-side.png",
        "classic-dad-hat-stone-product-details.png"
      ],
      navy: [
        "classic-dad-hat-navy-back.png",
        "classic-dad-hat-navy-right-side.png",
        "classic-dad-hat-navy-right-front.png",
        "classic-dad-hat-navy-front.png",
        "classic-dad-hat-navy-left-front.png",
        "classic-dad-hat-navy-left-side.png",
        "classic-dad-hat-navy-product-details.png"
      ],
      pink: [
        "classic-dad-hat-pink-back.png",
        "classic-dad-hat-pink-right-side.png",
        "classic-dad-hat-pink-right-front.png",
        "classic-dad-hat-pink-front.png",
        "classic-dad-hat-pink-left-front.png",
        "classic-dad-hat-pink-left-side.png",
        "classic-dad-hat-pink-product-details.png"
      ],
      white: [
        "classic-dad-hat-white-back.png",
        "classic-dad-hat-white-right-side.png",
        "classic-dad-hat-white-right-front.png",
        "classic-dad-hat-white-front.png",
        "classic-dad-hat-white-left-front.png",
        "classic-dad-hat-white-left-side.png",
        "classic-dad-hat-white-product-details.png"
      ],
      "light-blue": [
        "classic-dad-hat-light-blue-back.png",
        "classic-dad-hat-light-blue-right-side.png",
        "classic-dad-hat-light-blue-right-front.png",
        "classic-dad-hat-light-blue-front.png",
        "classic-dad-hat-light-blue-left-front.png",
        "classic-dad-hat-light-blue-left-side.png",
        "classic-dad-hat-light-blue-product-details.png"
      ],
      cranberry: [
        "classic-dad-hat-cranberry-back.png",
        "classic-dad-hat-cranberry-right-side.png",
        "classic-dad-hat-cranberry-right-front.png",
        "classic-dad-hat-cranberry-front.png",
        "classic-dad-hat-cranberry-left-front.png",
        "classic-dad-hat-cranberry-left-side.png",
        "classic-dad-hat-cranberry-product-details.png"
      ],
      spruce: [
        "classic-dad-hat-spruce-back.png",
        "classic-dad-hat-spruce-right-side.png",
        "classic-dad-hat-spruce-right-front.png",
        "classic-dad-hat-spruce-front.png",
        "classic-dad-hat-spruce-left-front.png",
        "classic-dad-hat-spruce-left-side.png",
        "classic-dad-hat-spruce-product-details.png"
      ]
    };

  let currentColor = "black";
  let currentStyle = "logo";
  let currentIndex = 3;
  let mot = motSelect.value;
  let Color_Josy = "black";

  function getImagePath(filename) {
    if (currentStyle === "signature") {
      return `Image/Casquette_Josy_mot/signature_${Color_Josy}/josy_${currentColor}/${filename}`;
    } else {
      return `Image/Casquette_Josy_mot/Logo_${mot}/${filename}`;
    }
  }

  function updateImage() {
    const images = baseImages[currentColor];
    if (!images) return;
    const file = images[currentIndex];
    const fullPath = getImagePath(file);
    productImage.style.opacity = 0;
    setTimeout(() => {
      productImage.src = fullPath;
      productImage.style.opacity = 1;
    }, 10);
  }

  // Vérifie si un dossier existe
  async function folderExists(url) {
    try {
      const response = await fetch(url, { method: "HEAD" });
      return response.ok;
    } catch {
      return false;
    }
  }

  // Met à jour les couleurs cliquables
  async function checkAvailableColors() {
    for (const dot of colorDots) {
      const color = dot.dataset.color;
      let path;
      if (currentStyle === "signature") {
        path = `Image/Casquette_Josy_mot/signature_${Color_Josy}/josy_${color}/`;
      } else {
        path = `Image/Casquette_Josy_mot/Logo_${mot}/classic-dad-hat-${color}-front.png`;
      }

      const exists = await folderExists(path);
      if (exists) {
        dot.style.opacity = "1";
        dot.style.pointerEvents = "auto";
        dot.style.filter = "none";
      } else {
        dot.style.opacity = "0.2";
        dot.style.pointerEvents = "none";
        dot.style.filter = "grayscale(100%)";
      }
    }
  }

  leftBtn.addEventListener("click", () => {
    const images = baseImages[currentColor];
    currentIndex = (currentIndex - 1 + images.length) % images.length;
    updateImage();
  });

  rightBtn.addEventListener("click", () => {
    const images = baseImages[currentColor];
    currentIndex = (currentIndex + 1) % images.length;
    updateImage();
  });

  colorDots.forEach(dot => {
    dot.addEventListener("click", () => {
      if (dot.style.pointerEvents === "none") return;
      document.querySelector("#productColors .color-dot.active").classList.remove("active");
      dot.classList.add("active");
      currentColor = dot.dataset.color;
      updateImage();
    });
  });

  signatureDots.forEach(dot => {
    dot.addEventListener("click", async () => {
      signatureColors.querySelector(".color-dot.active").classList.remove("active");
      dot.classList.add("active");
      Color_Josy = dot.dataset.signature;
      await checkAvailableColors();
      updateImage();
    });
  });

  typeSelect.addEventListener("change", async () => {
    currentStyle = typeSelect.value;
    if (currentStyle === "signature") {
      motOption.classList.add("hidden");
      signatureColors.classList.remove("hidden");
    } else {
      motOption.classList.remove("hidden");
      signatureColors.classList.add("hidden");
    }
    await checkAvailableColors();
    updateImage();
  });

  motSelect.addEventListener("change", async () => {
    mot = motSelect.value;
    await checkAvailableColors();
    updateImage();
  });

  // Initialisation
  checkAvailableColors();
  updateImage();
</script>

</body>
</html>
